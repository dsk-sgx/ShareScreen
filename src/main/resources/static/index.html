<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html charset=UTF-8">
<script type="text/javascript" src="./jquery.js"></script>
<script type="text/javascript">
	$(function() {
		var maxLevel = 4
		for (i = 1; i <= maxLevel; i++) {
			var ws = new WebSocket("ws://" + location.host + "/screens/" + maxLevel + '/' + i)
			ws.onopen = function() {
			}
			ws.onclose = function() {
			}
			ws.onmessage = function(response) {
				var url = response.srcElement.url
				var level = url.substring(url.lastIndexOf('/') + 1);
				var image = $("#screen" + level)
				console.log(level)
				var url = URL.createObjectURL(new Blob([ response.data ], {
					type : "image/png"
				}))
				image.onload = function() {
					URL.revokeObjectURL(url)
				}
				image.attr('src', url)
			}
			ws.onerror = function(event) {
				console.log(event)
				console.log("connection error:" + event)
			}
		}

		var sendOperation = function(event) {
			ws.send(toJson(event));
		}

		var toJson = function(value) {
			var cache = []
			var result = JSON.stringify(value, function(key, value) {
				if (typeof value === 'object' && value !== null) {
					if (cache.indexOf(value) !== -1) {
						return

					}
					cache.push(value)
				}
				return value
			})
			cache = null
			return result
		}
		$('body').click(function(e) {
			sendOperation(e)
		})
		$('body').contextmenu(function(e) {
			sendOperation(e)
			return false
		})
	})
</script>
<style type="text/css">
  img {
  	margin-top:-2px;
  }
</style>
</head>
<body>
	<img id="screen1"></img>
	<img id="screen2"></img>
	<img id="screen3"></img>
	<img id="screen4"></img>
</body>
</html>
